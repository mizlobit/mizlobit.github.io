<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DEMAKOV_AI_AVATAR — цифровые клоны и продакшн контента</title>
  <meta name="description" content="Цифровые клоны, которые ускоряют производство контента: аватар, сценарии, монтаж, генерация и сопровождение." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2242%22 fill=%22%230af%22/></svg>">
  <style>
    :root{
      --bg:#03060a; --bg2:#051019; --card:#0a121a; --muted:#8aa0bb; --text:#eaf2ff;
      --neon:#66e1ff; --neon2:#22c55e; --accent:#a5f3fc;
      --rad:20px; --shadow:0 12px 40px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% -10%, rgba(102,225,255,.10), transparent 55%),
        radial-gradient(1000px 600px at 110% -10%, rgba(34,197,94,.08), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2) 50%, var(--bg));
      scroll-behavior:smooth;
    }
    a{color:var(--accent);text-decoration:none}

    /* Header */
    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(130%) blur(10px);background:rgba(3,6,10,.55);border-bottom:1px solid #142435}
    .wrap{max-width:1120px;margin:0 auto;padding:0 18px}
    .header-line{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0}
    .logoTitle{font-weight:900;letter-spacing:.6px;color:#cfe9ff;text-transform:uppercase;white-space:nowrap}

    /* Buttons */
    .btn{position:relative;display:inline-flex;align-items:center;gap:10px;padding:12px 18px;border-radius:14px;border:1px solid #173245;background:linear-gradient(90deg,#66e1ff,#22c55e);color:#041018;font-weight:800;letter-spacing:.2px;box-shadow:var(--shadow);cursor:pointer;overflow:hidden;transition:transform .25s ease,filter .25s ease}
    .btn:hover{transform:translateY(-1px) scale(1.01);filter:saturate(1.1)}
    .btn.ghost{background:transparent;color:var(--text)}
    .btn::before{content:"";position:absolute;inset:-40% -20%;background:conic-gradient(from 0deg,#fff3,#0000 30%,#fff2 60%,#0000);transform:translateX(-100%);transition:transform .5s cubic-bezier(.2,.7,.2,1)}
    .btn:hover::before{transform:translateX(0)}
    .ripple{position:absolute;border-radius:50%;transform:scale(0);background:#fff5;animation:ripple .6s ease-out;pointer-events:none}
    @keyframes ripple{to{transform:scale(12);opacity:0}}

    /* Sections */
    section{opacity:0;transform:translateY(18px);transition:opacity .6s cubic-bezier(.2,.7,.2,1),transform .6s cubic-bezier(.2,.7,.2,1);margin:70px 0}
    section.visible{opacity:1;transform:translateY(0)}

    /* HERO — фон */
    .hero{
      display:grid; place-items:center; text-align:center;
      padding:90px 0 40px; position:relative; overflow:hidden; z-index:0; min-height:58vh;
    }
    .hero > *{ position:relative; z-index:2; }
    .hero::before{
      content:""; position:absolute; inset:0; z-index:0;
      background-image:url("assets/hero-bg.jpg?v=2");
      background-size:cover; background-position:center;
      transform:scale(1.03);
      filter:brightness(.55) saturate(1.08);
    }
    .hero::after{
      content:""; position:absolute; inset:0; z-index:1;
      background:
        radial-gradient(80% 60% at 20% 0% , rgba(102,225,255,.25), transparent 60%),
        radial-gradient(60% 40% at 85% 15%, rgba(34,197,94,.18), transparent 60%),
        linear-gradient(180deg, rgba(3,6,10,.10), rgba(3,6,10,.65));
    }
    h1{font-size:48px;line-height:1.05;margin:0 0 12px}
    .sub{font-size:18px;color:#cfe3ff}

    /* Cards */
    .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .card{background:linear-gradient(180deg,#0b131b,#0a1118);border:1px solid #142435;border-radius:var(--rad);padding:18px;box-shadow:var(--shadow)}
    .card h3{margin-top:0}

    /* Gallery */
    .gallery{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    .imgcard{position:relative;overflow:hidden;border-radius:var(--rad);border:1px solid #142435;background:#081018;min-height:300px}
    .imgcard video,.imgcard img{width:100%;height:100%;object-fit:cover;display:block;border-radius:var(--rad)}

    /* Controls + overlays */
    .poster{position:absolute;inset:0;background:#0a121a;display:flex;align-items:center;justify-content:center;z-index:2}
    .poster img{width:100%;height:100%;object-fit:cover;filter:brightness(.95) saturate(1.05)}
    .controls{position:absolute;right:12px;bottom:12px;display:flex;gap:8px;z-index:3}
    .ctrl{padding:8px 10px;border-radius:12px;border:1px solid #173245;background:#0c1620;color:#eaf2ff;font-weight:800;min-width:40px}
    .ctrl.active,.ctrl:hover{background:linear-gradient(90deg,#66e1ff,#22c55e);color:#041018}
    .bigplay{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:4;padding:12px 16px;border-radius:999px;border:1px solid #173245;background:#0c1620;color:#eaf2ff;font-weight:900}
    .spinner{position:absolute;left:12px;bottom:12px;width:22px;height:22px;border:3px solid #173245;border-top-color:#66e1ff;border-radius:50%;animation:spin 1s linear infinite;z-index:3}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Pricing */
    .price b{font-size:26px}
    .old{color:#92a6c2;text-decoration:line-through;font-size:14px}

    /* CTA */
    .cta{background:linear-gradient(180deg,#0b141e,#0a121a);border:1px solid #142435;border-radius:24px;padding:24px;box-shadow:var(--shadow);text-align:center}
    .cta h3{margin:0 0 8px}

    /* Footer */
    footer{border-top:1px solid #142435;padding:30px 0;color:#8aa0bb;text-align:center}

    /* Floating button */
    .fab{position:fixed;right:18px;bottom:18px;z-index:60;display:inline-flex;align-items:center;gap:10px;padding:14px 18px;border-radius:999px;background:linear-gradient(90deg,#66e1ff,#22c55e);color:#041018;font-weight:900;border:1px solid #173245;box-shadow:0 12px 30px #0008;animation:breathe 2.8s ease-in-out infinite}
    @keyframes breathe{0%{transform:translateY(0)}50%{transform:translateY(-1px)}100%{transform:translateY(0)}}

    /* Burger + drawer */
    .header-actions{display:flex;align-items:center;gap:12px}
    .burger{display:none;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;border:1px solid #173245;background:transparent;color:var(--text);font-weight:800;cursor:pointer}
    .burger:active{transform:translateY(1px)}
    .nav-drawer{position:fixed;inset:0;z-index:70;pointer-events:none}
    .nav-drawer .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.5);opacity:0;transition:opacity .25s ease}
    .nav-drawer .panel{position:absolute;right:0;top:0;height:100%;width:min(84vw,360px);background:linear-gradient(180deg,#0b141e,#0a121a);border-left:1px solid #142435;padding:18px;transform:translateX(100%);transition:transform .3s cubic-bezier(.2,.7,.2,1);box-shadow:-10px 0 30px #0007;display:flex;flex-direction:column;gap:10px}
    .nav-drawer .navlink{display:block;padding:12px 14px;border-radius:12px;border:1px solid #173245;background:#0c1620;color:var(--text)}
    .nav-drawer .navlink.primary{background:linear-gradient(90deg,#66e1ff,#22c55e);color:#041018;font-weight:900}
    .nav-drawer.open{pointer-events:auto}
    .nav-drawer.open .backdrop{opacity:1}
    .nav-drawer.open .panel{transform:translateX(0)}

    /* Mobile tweaks */
    @media (max-width:768px){
      header .header-actions{display:none}
      .burger{display:inline-flex;z-index:60}
      .logoTitle{font-size:12px;letter-spacing:.2px;max-width:48vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
      .hero{min-height:56vh;padding:64px 0 24px}
      .hero::before{filter:brightness(.45) saturate(1.05)}
      h1{font-size:clamp(24px,6vw,34px)}
      .sub{font-size:14px}
      .cards{grid-template-columns:1fr}
      .gallery{grid-template-columns:1fr}
      .btn{padding:8px 12px;border-radius:12px;font-weight:700}
      .btn::before{display:none}
      .fab{right:12px;bottom:12px;padding:12px 14px}
    }

    a:focus,button:focus{outline:2px solid #5ae0ff;outline-offset:2px;border-radius:12px}
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="wrap header-line">
      <div class="logoTitle">DEMAKOV_AI_AVATAR</div>
      <div class="header-actions">
        <a class="btn ghost" href="#advantages"><span>Преимущества</span></a>
        <a class="btn ghost" href="#learn"><span>Обучение</span></a>
        <a class="btn ghost" href="#pricing"><span>Тарифы</span></a>
        <a class="btn" href="https://t.me/demakovmikhail" target="_blank" rel="noopener"><span>Связаться в TG</span></a>
      </div>
      <button class="burger" aria-controls="navDrawer" aria-expanded="false" aria-label="Открыть меню">
        <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor" aria-hidden="true"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <span>Меню</span>
      </button>
    </div>
  </header>

  <!-- Mobile drawer -->
  <div id="navDrawer" class="nav-drawer" aria-hidden="true">
    <div class="backdrop"></div>
    <nav class="panel" role="menu">
      <a class="navlink" href="#advantages" role="menuitem">Преимущества</a>
      <a class="navlink" href="#gallery" role="menuitem">Визуал</a>
      <a class="navlink" href="#learn" role="menuitem">Обучение</a>
      <a class="navlink" href="#pricing" role="menuitem">Тарифы</a>
      <a class="navlink primary" href="https://t.me/demakovmikhail" target="_blank" rel="noopener" role="menuitem">Связаться в Telegram</a>
    </nav>
  </div>

  <main class="wrap">
    <!-- HERO -->
    <section class="hero">
      <h1>Цифровые клоны для быстрого и красивого контента</h1>
      <p class="sub">Аватар, сценарии, монтаж и сопровождение. Нейтральный голубой неон, 3D-ощущение и чистая типографика.</p>
      <div class="header-actions" style="gap:10px;justify-content:center">
        <a class="btn" href="#pricing"><span>Смотреть цены</span></a>
        <a class="btn" href="#gallery"><span>Визуал</span></a>
        <a class="btn" href="https://t.me/demakovmikhail" target="_blank" rel="noopener"><span>Заказать в Telegram</span></a>
      </div>
    </section>

    <!-- Advantages -->
    <section id="advantages">
      <h2>Преимущества цифрового клона</h2>
      <div class="cards">
        <article class="card"><h3>Экономия времени</h3><p>15–30 роликов за цикл без повторных съёмок. Быстрое обновление текстов и CTA.</p></article>
        <article class="card"><h3>Стабильный образ</h3><p>Единый голос и визуал — контент ровный и узнаваемый, без «скачков» качества.</p></article>
        <article class="card"><h3>Снижение бюджета</h3><p>Меньше затрат на локации, реквизит и пересъём. Подписка и аватар окупаются тиражом.</p></article>
        <article class="card"><h3>Скорость релизов</h3><p>Параллельная генерация и чёткие дедлайны. Публикации выходят по плану.</p></article>
        <article class="card"><h3>Мультиязычность</h3><p>Озвучка и субтитры под RU/EN/TH и др. Вы легко расширяете охват.</p></article>
        <article class="card"><h3>Гибкость сценариев</h3><p>A/B-тесты форматов и офферов, отдельные версии под сегменты и площадки.</p></article>
      </div>
    </section>

    <!-- Gallery: 4 ролика с надёжным автозапуском и контролами -->
    <section id="gallery">
      <h2>Визуал оцифровки</h2>
      <div class="gallery">
        <!-- 1 -->
        <div class="imgcard vidwrap"
             data-src1="assets/gallery-1.mp4?v=12" data-src2="assets/assets/gallery-1.mp4?v=12"
             data-poster1="assets/IMG_3630.jpeg" data-poster2="assets/assets/IMG_3630.jpeg">
          <video muted playsinline webkit-playsinline loop preload="none" poster="assets/IMG_3630.jpeg"></video>
          <div class="poster"><img alt="Превью 1"></div>
          <button class="bigplay" type="button" hidden>▶</button>
          <div class="controls">
            <button class="ctrl playpause" aria-label="Пауза">⏸</button>
            <button class="ctrl stop" aria-label="Стоп">⏹</button>
            <button class="ctrl mute active" aria-label="Звук выкл">🔇</button>
          </div>
          <div class="spinner" hidden></div>
        </div>
        <!-- 2 -->
        <div class="imgcard vidwrap"
             data-src1="assets/gallery-2.mp4?v=12" data-src2="assets/assets/gallery-2.mp4?v=12"
             data-poster1="assets/IMG_3631.jpeg" data-poster2="assets/assets/IMG_3631.jpeg">
          <video muted playsinline webkit-playsinline loop preload="none" poster="assets/IMG_3631.jpeg"></video>
          <div class="poster"><img alt="Превью 2"></div>
          <button class="bigplay" type="button" hidden>▶</button>
          <div class="controls">
            <button class="ctrl playpause" aria-label="Пауза">⏸</button>
            <button class="ctrl stop" aria-label="Стоп">⏹</button>
            <button class="ctrl mute active" aria-label="Звук выкл">🔇</button>
          </div>
          <div class="spinner" hidden></div>
        </div>
        <!-- 3 (добавь файл, если ещё не загрузил) -->
        <div class="imgcard vidwrap"
             data-src1="assets/gallery-3.mp4?v=1" data-src2="assets/assets/gallery-3.mp4?v=1"
             data-poster1="assets/IMG_3632.jpeg">
          <video muted playsinline webkit-playsinline loop preload="none" poster="assets/IMG_3632.jpeg"></video>
          <div class="poster"><img alt="Превью 3"></div>
          <button class="bigplay" type="button" hidden>▶</button>
          <div class="controls">
            <button class="ctrl playpause" aria-label="Пауза">⏸</button>
            <button class="ctrl stop" aria-label="Стоп">⏹</button>
            <button class="ctrl mute active" aria-label="Звук выкл">🔇</button>
          </div>
          <div class="spinner" hidden></div>
        </div>
        <!-- 4 (добавь файл, если ещё не загрузил) -->
        <div class="imgcard vidwrap"
             data-src1="assets/gallery-4.mp4?v=1" data-src2="assets/assets/gallery-4.mp4?v=1"
             data-poster1="assets/IMG_3633.jpeg">
          <video muted playsinline webkit-playsinline loop preload="none" poster="assets/IMG_3633.jpeg"></video>
          <div class="poster"><img alt="Превью 4"></div>
          <button class="bigplay" type="button" hidden>▶</button>
          <div class="controls">
            <button class="ctrl playpause" aria-label="Пауза">⏸</button>
            <button class="ctrl stop" aria-label="Стоп">⏹</button>
            <button class="ctrl mute active" aria-label="Звук выкл">🔇</button>
          </div>
          <div class="spinner" hidden></div>
        </div>
      </div>
    </section>

    <!-- Обучение -->
    <section id="learn">
      <h2>Обучение созданию цифровых клонов — 20 000 ₽</h2>
      <div class="cards">
        <article class="card">
          <h3>Что получите</h3>
          <ul>
            <li>Пошаговый пайплайн: от съёмки до публикации.</li>
            <li>Настройка аватара и липсинка: софт, пресеты, голос.</li>
            <li>Сценарные шаблоны для рилс/шортс + A/B-тесты.</li>
            <li>Монтаж-флоу: звук, ритм, субтитры, цвет, экспорт.</li>
            <li>Гайд по контент-системе: план, частота, метрики.</li>
          </ul>
        </article>
        <article class="card">
          <h3>Почему это окупается</h3>
          <ul>
            <li>Сокращение продакшн-времени в 2–4 раза.</li>
            <li>Стабильное качество без пересъёмов.</li>
            <li>Масштабирование: 15–30 роликов в поток.</li>
            <li>Рост охватов за счёт ровного образа и темпа выходов.</li>
            <li>Готовые пресеты и чек-листы — запускаетесь за 1–2 дня.</li>
          </ul>
        </article>
        <article class="card">
          <h3>Формат</h3>
          <p>Интенсив 3–4 часа в Zoom + записи и материалы. Ответы на вопросы и разбор ваших задач.</p>
          <a class="btn" href="https://t.me/demakovmikhail" target="_blank" rel="noopener"><span>Записаться на обучение</span></a>
        </article>
      </div>
    </section>

    <!-- Pricing -->
    <section id="pricing">
      <h2>Тарифные пакеты</h2>
      <div class="cards">
        <article class="card">
          <h3>МИНИ</h3>
          <p class="price"><b>15 рилс — 25 000</b> <span class="muted">(≈ 1 666 ₽/рилс)</span></p>
          <p class="price"><b>30 рилс — 35 000</b> <span class="muted">(≈ 1 166 ₽/рилс)</span></p>
          <div class="old">Старая цена: 30 000 / 40 000</div>
          <ul>
            <li>Регистрация аккаунта</li><li>Подписка на 1 мес. (~36$)</li><li>Аватар до 3 шт.</li>
            <li>Монтаж и озвучка, улучшение звука</li><li>Генерация ролика</li>
            <li>Цветокоррекция, субтитры, музыка</li><li>Сопровождение</li><li>Нейрофотосессия</li>
          </ul>
          <a class="btn" href="https://t.me/demakovmikhail" target="_blank" rel="noopener"><span>Выбрать МИНИ в TG</span></a>
        </article>
        <article class="card">
          <h3>СТАНДАРТ</h3>
          <p class="price"><b>15 рилс — 30 000</b> <span class="muted">(≈ 2 000 ₽/рилс)</span></p>
          <p class="price"><b>30 рилс — 45 000</b> <span class="muted">(≈ 1 500 ₽/рилс)</span></p>
          <div class="old">Старая цена: 35 000 / 50 000</div>
          <ul>
            <li>Регистрация аккаунта</li><li>Подписка на 1 мес. (~36$)</li><li>Аватар до 5 шт.</li>
            <li>Монтаж и озвучка, улучшение звука</li><li>Генерация роликов</li>
            <li>Цветокоррекция, субтитры, музыка, переходы</li><li>Футажи (2–5 шт.)</li>
            <li>Сопровождение</li><li>Нейрофотосессия: 15 образов</li>
          </ul>
          <a class="btn" href="https://t.me/demakovmikhail" target="_blank" rel="noopener"><span>Выбрать СТАНДАРТ в TG</span></a>
        </article>
        <article class="card">
          <h3>МАКСИ</h3>
          <p class="price"><b>15 рилс — 40 000</b> <span class="muted">(≈ 2 666 ₽/рилс)</span></p>
          <p class="price"><b>30 рилс — 65 000</b> <span class="muted">(≈ 2 166 ₽/рилс)</span></p>
          <div class="old">Старая цена: 50 000 / 75 000</div>
          <ul>
            <li>Регистрация аккаунта</li><li>Подписка на 1 мес. (~36$)</li><li>Аватар до 10 шт.</li>
            <li>Монтаж и озвучка, улучшение звука</li><li>Генерация роликов</li>
            <li>Цветокоррекция, субтитры, музыка, переходы</li><li>Футажи каждые 3–5 сек</li>
            <li>Сопровождение</li><li>Нейрофотосессия: 30 образов</li>
          </ul>
          <a class="btn" href="https://t.me/demakovmikhail" target="_blank" rel="noopener"><span>Выбрать МАКСИ в TG</span></a>
        </article>
      </div>
    </section>

    <!-- CTA -->
    <section id="contact">
      <div class="cta">
        <h3>Готовы запустить своего цифрового клона?</h3>
        <p style="color:#cfe3ff">Напишите в Telegram — обсудим цели, объём и сроки и подберём пакет.</p>
        <a class="btn" href="https://t.me/demakovmikhail" target="_blank" rel="noopener"><span>Связаться в Telegram</span></a>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap">© <span id="year"></span> DEMAKOV_AI_AVATAR. Все права защищены.</div>
  </footer>

  <!-- Floating CTA -->
  <a class="fab" href="https://t.me/demakovmikhail" target="_blank" rel="noopener" aria-label="Связаться в Telegram">Заказать в TG</a>

  <script>
    // год в футере
    document.getElementById('year').textContent = new Date().getFullYear();

    // анимация появления секций
    const observer = new IntersectionObserver(entries=>{
      entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('visible'); observer.unobserve(e.target);} });
    }, {threshold:.12});
    document.querySelectorAll('section').forEach(s=>observer.observe(s));

    // ripple на кнопках
    document.querySelectorAll('.btn,.fab').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        const r = btn.getBoundingClientRect();
        const circle = document.createElement('span');
        const d = Math.max(r.width, r.height);
        circle.className='ripple';
        circle.style.width=circle.style.height=d+'px';
        circle.style.left=(e.clientX - r.left - d/2)+'px';
        circle.style.top=(e.clientY - r.top - d/2)+'px';
        btn.appendChild(circle);
        setTimeout(()=>circle.remove(), 600);
      });
    });

    // бургер-меню
    (function(){
      const burger = document.querySelector('.burger');
      const drawer = document.getElementById('navDrawer');
      if(!burger || !drawer) return;
      const backdrop = drawer.querySelector('.backdrop');
      const links = drawer.querySelectorAll('a');
      const openD = ()=>{drawer.classList.add('open');burger.setAttribute('aria-expanded','true');drawer.setAttribute('aria-hidden','false');document.body.style.overflow='hidden'};
      const closeD = ()=>{drawer.classList.remove('open');burger.setAttribute('aria-expanded','false');drawer.setAttribute('aria-hidden','true');document.body.style.overflow=''};
      burger.addEventListener('click', ()=> drawer.classList.contains('open') ? closeD() : openD());
      backdrop.addEventListener('click', closeD);
      links.forEach(a=>a.addEventListener('click', closeD));
      window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeD(); });
    })();

    // Видео: надёжная загрузка + автоплей + контролы
    (function(){
      const wraps = document.querySelectorAll('.vidwrap');

      wraps.forEach(w=>{
        const v = w.querySelector('video');
        const posterBox = w.querySelector('.poster');
        const posterImg = posterBox.querySelector('img');
        const bigplay = w.querySelector('.bigplay');
        const spinner = w.querySelector('.spinner');
        const btnPlay = w.querySelector('.playpause');
        const btnStop = w.querySelector('.stop');
        const btnMute = w.querySelector('.mute');

        // источники и постеры
        const sources = [w.dataset.src1, w.dataset.src2].filter(Boolean);
        const posters = [w.dataset.poster1, w.dataset.poster2].filter(Boolean);
        if (posters[0]) { posterImg.src = posters[0]; v.setAttribute('poster', posters[0]); }

        // iOS: атрибут muted должен стоять ДО play()
        v.muted = true; v.setAttribute('muted',''); v.setAttribute('playsinline',''); v.loop = true;

        let loaded = false, inView = false, tried = 0, userStarted = false;

        function setSource(i){
          if(i >= sources.length){ // нечего грузить
            showBigPlay(); return;
          }
          tried = i;
          spinner.hidden = false;
          v.src = sources[i];
          v.load();
        }

        function tryNext(){ setSource(tried+1); }

        function attemptPlay(){
          const p = v.play();
          if(p && p.catch){
            p.then(()=>{ onPlayStart(); })
             .catch(()=>{ showBigPlay(); }); // нужен жест
          } else {
            // старые браузеры
            setTimeout(()=> { if(!v.paused) onPlayStart(); else showBigPlay(); }, 300);
          }
        }

        function onPlayStart(){
          spinner.hidden = true;
          posterBox.style.display='none';
          bigplay.hidden = true;
          btnPlay.textContent = '⏸';
          userStarted = true;
        }

        function showBigPlay(){ spinner.hidden = true; bigplay.hidden = false; }

        // события загрузки
        v.addEventListener('loadeddata', ()=>{ loaded = true; if(inView || userStarted) attemptPlay(); });
        v.addEventListener('error', tryNext);
        v.addEventListener('playing', onPlayStart);

        // контролы
        btnPlay.addEventListener('click', ()=>{
          if(v.paused){ v.play().catch(()=>{}); btnPlay.textContent='⏸'; }
          else { v.pause(); btnPlay.textContent='▶'; }
        });

        btnStop.addEventListener('click', ()=>{
          v.pause(); v.currentTime = 0; btnPlay.textContent='▶';
          posterBox.style.display=''; // показать постер
        });

        btnMute.addEventListener('click', ()=>{
          v.muted = !v.muted;
          btnMute.classList.toggle('active', v.muted);
          btnMute.textContent = v.muted ? '🔇' : '🔈';
          if(!v.paused){ v.play().catch(()=>{}); }
        });

        bigplay.addEventListener('click', ()=>{ userStarted = true; attemptPlay(); });

        // наблюдатель за видимостью
        const io = new IntersectionObserver(entries=>{
          const e = entries[0];
          inView = e.isIntersecting;
          if(inView){
            if(!loaded) setSource(0);
            else attemptPlay();
          }else{
            v.pause();
          }
        }, {threshold:.2});
        io.observe(w);

        // если вкладка скрыта — приостанавливаем
        document.addEventListener('visibilitychange', ()=>{
          if(document.hidden) v.pause();
          else if(inView && (loaded || userStarted)) attemptPlay();
        });
      });
    })();
  </script>
</body>
</html>
